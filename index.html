<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Grupos WhatsApp</title>
<meta property="og:title" content="Grifinoria">
<meta property="og:description" content="Convite para conversar em grupo">
<meta property="og:image" content="https://files.catbox.moe/ls07y5.jpg">
<meta property="og:url" content="https://saniofc.github.io/griffinoria/">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Arial,sans-serif;color:#fff;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding-top:120px;background:#000}
#video-bg{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:-1;filter:brightness(0.4)}
header{position:fixed;top:0;left:0;width:100%;padding:12px 10px;background:rgba(0,0,0,0.6);text-align:center;z-index:1000}
header h1{font-size:28px;text-shadow:2px 2px 5px #000}
header p{margin-top:4px;text-shadow:1px 1px 3px #000}
#contador{margin-top:4px;color:#ffd700;text-shadow:1px 1px 2px #000;font-size:15px}
#categorias{margin-top:8px;display:flex;justify-content:center;gap:6px;flex-wrap:wrap}
.cat-btn{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);border-radius:20px;color:#fff;font-size:13px;padding:5px 11px;cursor:pointer;transition:all .2s}
.cat-btn:hover{background:rgba(255,255,255,0.25)}
.cat-btn.active{background:#b78cff;border-color:#b78cff}
.menu-icon{position:fixed;top:20px;right:20px;font-size:28px;z-index:1100;background:rgba(0,0,0,0.6);padding:6px 12px;border-radius:10px;cursor:pointer}
.menu{position:fixed;top:0;right:-300px;width:300px;height:100%;background:rgba(0,0,0,0.9);padding:30px 20px;transition:right .3s;z-index:1200}
.menu.open{right:0}
.menu .close-btn{position:absolute;top:15px;right:20px;background:none;border:none;color:#fff;font-size:26px;cursor:pointer}
.menu h2{margin-top:50px;color:#b78cff;border-bottom:1px solid #b78cff;padding-bottom:5px;text-align:left}
.menu a{display:block;text-decoration:none;color:#fff;background:rgba(183,140,255,0.12);padding:12px;border-radius:10px;margin-top:15px;text-align:left;font-size:18px}
.menu a:hover{background:rgba(183,140,255,0.25)}
#lista-grupos{width:100%;max-width:420px;padding:30px 20px 60px;display:flex;flex-direction:column;align-items:center;gap:18px}
.grupo{width:100%;max-width:380px;display:flex;align-items:center;gap:14px;background:rgba(0,0,0,0.55);padding:14px 20px;border-radius:20px;text-decoration:none;color:#fff;position:relative;transition:transform .18s,background .18s;border:1px solid rgba(255,255,255,0.06)}
.grupo:hover{transform:scale(1.02);background:rgba(0,0,0,0.65)}
.grupo .left-star{position:absolute;left:-18px;top:50%;transform:translateY(-50%);width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:transparent;pointer-events:none}
.grupo.vip .left-star{box-shadow:0 0 18px 6px rgba(255,215,0,0.12), inset 0 0 8px rgba(255,215,0,0.08);border:2px solid rgba(255,215,0,0.6)}
.grupo .left-star img{width:46px;height:46px;border-radius:50%;object-fit:cover;border:2px solid #fff}
.grupo .info{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;text-align:left;margin-left:10px}
.grupo span.nome{font-size:18px;font-weight:bold;line-height:1.2}
.grupo .categoria{font-size:13px;color:#ffd700;margin-top:6px}
.grupo .cliques{position:absolute;top:8px;right:12px;font-size:12px;color:#ffd700}
.controls{position:absolute;left:8px;bottom:8px;display:flex;gap:6px}
.small-btn{background:rgba(255,255,255,0.06);border:none;color:#fff;padding:6px 8px;border-radius:10px;cursor:pointer}
.small-btn:hover{background:rgba(255,255,255,0.12)}
.botao{background:rgba(0,0,0,0.7);color:#fff;border:2px solid #fff;border-radius:30px;padding:12px 28px;margin-top:20px;text-decoration:none;font-size:18px;transition:transform .18s,box-shadow .18s;display:inline-block}
.botao:hover{transform:scale(1.04)}
footer{position:fixed;bottom:0;left:0;width:100%;background:rgba(0,0,0,0.8);color:#ccc;text-align:center;padding:14px 10px;font-size:14px;line-height:1.6;z-index:2000}
footer a{color:#b78cff;text-decoration:none}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;justify-content:center;align-items:center;z-index:5000}
.modal-content{background:#111;padding:18px;border-radius:12px;max-width:420px;width:92%;text-align:center;color:#fff;position:relative}
.modal-content h3{margin-bottom:12px}
.modal-content input, .modal-content select{width:92%;margin:6px 0;padding:8px;border-radius:8px;border:none}
.modal-content label{display:block;text-align:left;font-size:13px;margin-left:4px;margin-top:6px}
.modal-content .row{display:flex;gap:8px;justify-content:center;align-items:center}
.modal .close-modal{position:absolute;top:8px;right:10px;font-size:20px;cursor:pointer}
.note{font-size:13px;color:#ccc;margin-top:6px}
</style>
</head>
<body>
<video id="video-bg" autoplay muted loop playsinline>
  <source src="https://files.catbox.moe/dymzif.mp4" type="video/mp4">
</video>

<header>
  <h1>Grupos WhatsApp</h1>
  <p>amaldiÃ§oado seja tu q nÃ£o entra no grupoðŸª„</p>
  <p id="contador">Visitas: 0</p>
  <div id="categorias">
    <button class="cat-btn active" data-cat="Todos">Todos</button>
    <button class="cat-btn" data-cat="Amizade">Amizade</button>
    <button class="cat-btn" data-cat="Zoeira">Zoeira</button>
    <button class="cat-btn" data-cat="Namoro">Namoro</button>
  </div>
</header>

<div class="menu-icon" id="menuBtn">â˜°</div>
<div class="menu" id="sideMenu">
  <button class="close-btn" id="closeBtn">âœ•</button>
  <h2>InformaÃ§Ãµes</h2>
  <a href="https://br.shp.ee/1r878lx?smtt=0.0.9" target="_blank">ðŸ›’ Loja da Miih</a>
  <a href="https://wa.me//5521977231625" target="_blank">ðŸ“… Alugar bot</a>
  <a href="#" id="meusGrupos">ðŸ‘¥ Meus Grupos</a>
  <a href="#" id="enviarGrupo">âž• Enviar Meu Grupo</a>
  <a href="https://wa.me//5521977231625" target="_blank">ðŸ›’ Comprar bot</a>
</div>

<div id="lista-grupos"></div>
<a class="botao" href="https://linkfly.to/grifinoria" target="_blank">Outros Grupos</a>

<footer>
  Blog Â· Termos de Uso Â· PolÃ­tica de Privacidade Â· FAQ<br>
  Â© COPYRIGHT 2025 - <a href="https://saniofc.github.io/griffinoria/" target="_blank">saniofc.github.io/griffinoria/</a>
</footer>

<!-- Modal (criar / editar) -->
<div class="modal" id="modal">
  <div class="modal-content">
    <span class="close-modal" id="closeModal">âœ•</span>
    <h3 id="modalTitle">Enviar Meu Grupo</h3>

    <label for="grupoNome">Nome do grupo</label>
    <input id="grupoNome" type="text" placeholder="Nome do grupo">

    <label for="grupoLink">Link do grupo (https://chat.whatsapp.com/...)</label>
    <input id="grupoLink" type="text" placeholder="https://chat.whatsapp.com/...">

    <label for="grupoFoto">URL da foto (opcional)</label>
    <input id="grupoFoto" type="text" placeholder="https://... (opcional)">

    <label for="grupoCategoria">Categoria</label>
    <select id="grupoCategoria">
      <option value="">Selecione a categoria</option>
      <option value="Amizade">Amizade</option>
      <option value="Zoeira">Zoeira</option>
      <option value="Namoro">Namoro</option>
    </select>

    <label for="grupoVipCode">CÃ³digo VIP (opcional)</label>
    <input id="grupoVipCode" type="text" placeholder="Coloque o cÃ³digo VIP se tiver">

    <div class="row">
      <button class="small-btn" id="salvarGrupo">Salvar Grupo</button>
    </div>
    <p class="note">Somente quem enviou poderÃ¡ editar/excluir seu grupo. CÃ³digo VIP coloca o grupo no topo.</p>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getDatabase, ref, onValue, set, remove, runTransaction } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

/* -------- CONFIG ---------- */
// altere aqui o cÃ³digo VIP quando quiser (string vazia = sem cÃ³digo VIP disponÃ­vel)
const VIP_CODE = "lhdunso7"; // <--- troque aqui quando necessÃ¡rio

const firebaseConfig = {
  apiKey: "AIzaSyDsrYjO2yVTemKqwmJRzNjh5sfaMalPqhE",
  authDomain: "cliques-4a2c1.firebaseapp.com",
  databaseURL: "https://cliques-4a2c1-default-rtdb.firebaseio.com",
  projectId: "cliques-4a2c1",
  storageBucket: "cliques-4a2c1.firebasestorage.app",
  messagingSenderId: "903875153255",
  appId: "1:903875153255:web:ff3cf25e059b10d665b3c2",
  measurementId: "G-BQHZ7FWRJD"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* -------- DOM / estado -------- */
const menu = document.getElementById('sideMenu');
document.getElementById('menuBtn').addEventListener('click', ()=>menu.classList.add('open'));
document.getElementById('closeBtn').addEventListener('click', ()=>menu.classList.remove('open'));

const enviarBtn = document.getElementById('enviarGrupo');
const meusBtn = document.getElementById('meusGrupos');
const modal = document.getElementById('modal');
const closeModal = document.getElementById('closeModal');
const modalTitle = document.getElementById('modalTitle');
const inpNome = document.getElementById('grupoNome');
const inpLink = document.getElementById('grupoLink');
const inpFoto = document.getElementById('grupoFoto');
const inpCategoria = document.getElementById('grupoCategoria');
const inpVipCode = document.getElementById('grupoVipCode');
const btnSalvar = document.getElementById('salvarGrupo');

let todosGrupos = []; // lista combinada (json + firebase + local)
let modoEdicao = null; // null ou nome do grupo que estÃ¡ sendo editado

/* ------- visitantes/ID do usuÃ¡rio ------- */
const usuarioID = localStorage.getItem('usuarioID') || crypto.randomUUID();
localStorage.setItem('usuarioID', usuarioID);

/* ------- VISITAS ------- */
const contador = document.getElementById('contador');
const visitasRef = ref(db,'visitas');
onValue(visitasRef, snap => contador.textContent = `Visitas: ${snap.val() || 0}`);
runTransaction(visitasRef, v => (v || 0) + 1);
function atualizarVisitas(){ runTransaction(visitasRef, v => (v || 0) + 1); }

/* ------- helpers ------- */
function ordenarEUnir(list){
  // remove duplicados por nome (firebase sobrepÃµe grupos.json; local enviados tambÃ©m)
  const mapa = new Map();
  list.forEach(g => {
    mapa.set(g.nome, g);
  });
  const arr = Array.from(mapa.values());
  // ordenar: vip true primeiro (por timestamp decrescente), depois timestamp decrescente
  arr.sort((a,b)=>{
    if((b.vip?1:0) !== (a.vip?1:0)) return (b.vip?1:0) - (a.vip?1:0);
    const ta = a.timestamp || 0, tb = b.timestamp || 0;
    return tb - ta;
  });
  return arr;
}

/* ------- renderizar grupos ------- */
function renderizarGrupos(lista){
  const container = document.getElementById('lista-grupos');
  container.innerHTML = '';
  const usuario = localStorage.getItem('usuarioID');

  lista.forEach(g => {
    const card = document.createElement('div');
    card.className = 'grupo' + (g.vip ? ' vip' : '');
    // link wrapper clickable
    const linkEl = document.createElement('a');
    linkEl.href = g.link;
    linkEl.target = '_blank';
    linkEl.style.display = 'flex';
    linkEl.style.alignItems = 'center';
    linkEl.style.gap = '12px';
    linkEl.style.width = '100%';
    linkEl.style.textDecoration = 'none';
    linkEl.style.color = 'inherit';

    // left star + img if vip
    const left = document.createElement('div');
    left.className = 'left-star';
    if(g.vip){
      const img = document.createElement('img');
      img.src = g.foto || 'https://files.catbox.moe/ls07y5.jpg';
      img.alt = g.nome;
      left.appendChild(img);
      card.appendChild(left);
    }

    // foto normal (inside card)
    const foto = document.createElement('img');
    foto.className = 'foto';
    foto.src = g.foto || 'https://files.catbox.moe/ls07y5.jpg';
    foto.alt = g.nome;

    // info
    const info = document.createElement('div');
    info.className = 'info';
    const nomeEl = document.createElement('span');
    nomeEl.className = 'nome';
    nomeEl.textContent = g.nome;
    const catEl = document.createElement('div');
    catEl.className = 'categoria';
    catEl.textContent = g.categoria || '';
    info.appendChild(nomeEl);
    info.appendChild(catEl);

    // cliques
    const cliquesEl = document.createElement('div');
    cliquesEl.className = 'cliques';
    cliquesEl.textContent = 'Cliques: 0';

    // montar linkEl
    linkEl.appendChild(foto);
    linkEl.appendChild(info);

    // clique abre link + incrementa contagem no firebase
    const cliqueRef = ref(db, 'cliques/' + encodeURIComponent(g.nome));
    onValue(cliqueRef, snap => {
      cliquesEl.textContent = `Cliques: ${snap.val()||0}`;
    });
    linkEl.addEventListener('click', (e) => {
      e.preventDefault();
      runTransaction(cliqueRef, c => (c||0)+1).then(()=> window.open(g.link, '_blank'));
      atualizarVisitas();
    });

    card.appendChild(linkEl);
    card.appendChild(cliquesEl);

    // Se dono -> mostrar botÃµes embaixo (Excluir / Editar)
    if(g.dono === usuario){
      const controls = document.createElement('div');
      controls.className = 'controls';

      const btnEditar = document.createElement('button');
      btnEditar.className = 'small-btn';
      btnEditar.textContent = 'Editar';
      btnEditar.addEventListener('click', (ev)=>{
        ev.stopPropagation(); ev.preventDefault();
        abrirModalEdicao(g);
      });

      const btnExcluir = document.createElement('button');
      btnExcluir.className = 'small-btn';
      btnExcluir.textContent = 'Excluir';
      btnExcluir.addEventListener('click', async (ev)=>{
        ev.stopPropagation(); ev.preventDefault();
        if(confirm('Deseja excluir este grupo?')){
          // remover do firebase e do localStorage
          try{
            await remove(ref(db, 'grupos/' + encodeURIComponent(g.nome)));
          }catch(e){ console.warn('Erro removendo no firebase', e); }
          // remover de gruposEnviados
          let enviados = JSON.parse(localStorage.getItem('gruposEnviados') || '[]');
          enviados = enviados.filter(x=>x.nome !== g.nome);
          localStorage.setItem('gruposEnviados', JSON.stringify(enviados));
          // atualizar array local e rerender
          todosGrupos = todosGrupos.filter(x=>x.nome !== g.nome);
          renderizarGrupos(todosGrupos);
        }
      });

      const btnVip = document.createElement('button');
      btnVip.className = 'small-btn';
      btnVip.textContent = g.vip ? 'Remover VIP' : 'Marcar VIP';
      btnVip.addEventListener('click', (ev)=>{
        ev.stopPropagation(); ev.preventDefault();
        // abrir modal de ediÃ§Ã£o jÃ¡ com foco no campo VIP
        abrirModalEdicao(g, true);
      });

      controls.appendChild(btnEditar);
      controls.appendChild(btnExcluir);
      controls.appendChild(btnVip);
      card.appendChild(controls);
    }

    container.appendChild(card);
  });
}

/* ------- Modal abrir / fechar / salvar ------- */
function abrirModalEdicao(grupo = null, focarVip=false){
  modoEdicao = grupo ? grupo.nome : null;
  modalTitle.textContent = grupo ? 'Editar Grupo' : 'Enviar Meu Grupo';
  inpNome.value = grupo ? grupo.nome : '';
  inpLink.value = grupo ? grupo.link : '';
  inpFoto.value = grupo ? grupo.foto : '';
  inpCategoria.value = grupo ? (grupo.categoria || '') : '';
  inpVipCode.value = '';
  modal.style.display = 'flex';
  if(focarVip) inpVipCode.focus();
}

enviarBtn.addEventListener('click', ()=> abrirModalEdicao(null));
closeModal.addEventListener('click', ()=> { modal.style.display = 'none'; modoEdicao = null; });

/* ------- salvar grupo (criar / editar) ------- */
btnSalvar.addEventListener('click', async ()=>{
  const nome = inpNome.value.trim();
  const link = inpLink.value.trim();
  const foto = inpFoto.value.trim() || 'https://files.catbox.moe/ls07y5.jpg';
  const categoria = inpCategoria.value;
  const codigoVip = inpVipCode.value.trim();

  if(!nome || !link.startsWith('https://chat.whatsapp.com/')){
    alert('Preencha corretamente o nome e link do grupo (deve comeÃ§ar com https://chat.whatsapp.com/).');
    return;
  }

  // determinar vip
  let vip = false;
  if(VIP_CODE && codigoVip && codigoVip === VIP_CODE){
    vip = true;
  } else {
    vip = false;
  }

  // timestamp para ordenaÃ§Ã£o (se vip true, atual timestamp; se jÃ¡ tinha timestamp, manter se nÃ£o for vip)
  const timestamp = vip ? Date.now() : (modoEdicao ? ( (todosGrupos.find(g=>g.nome===modoEdicao)||{}).timestamp || Date.now() ) : Date.now());

  const novoGrupo = {
    nome,
    link,
    foto,
    categoria,
    dono: usuarioID,
    vip,
    timestamp
  };

  // se modoEdicao: atualizar (nome pode ter sido alterado -> removemos o antigo)
  if(modoEdicao){
    // se o nome mudou e jÃ¡ existe um grupo com o novo nome no firebase -> alert e abort
    if(modoEdicao !== nome && todosGrupos.some(g=>g.nome === nome)){
      if(!confirm('JÃ¡ existe um grupo com esse nome. Substituir?')) return;
    }
    // salvar no firebase em chave por nome (usar encodeURIComponent para seguranÃ§a)
    try{
      await set(ref(db, 'grupos/' + encodeURIComponent(nome)), novoGrupo);
      // se o nome mudou, remover a antiga chave no firebase
      if(modoEdicao !== nome){
        try { await remove(ref(db, 'grupos/' + encodeURIComponent(modoEdicao))); } catch(e){ /*ignore*/ }
      }
    }catch(e){ console.error('Erro salvando no firebase', e); }

    // atualizar localStorage 'gruposEnviados'
    let enviados = JSON.parse(localStorage.getItem('gruposEnviados') || '[]');
    enviados = enviados.filter(g=>g.nome !== modoEdicao);
    enviados.push(novoGrupo);
    localStorage.setItem('gruposEnviados', JSON.stringify(enviados));
  } else {
    // criar novo
    try{
      await set(ref(db, 'grupos/' + encodeURIComponent(nome)), novoGrupo);
    }catch(e){ console.error('Erro salvando no firebase', e); }
    let enviados = JSON.parse(localStorage.getItem('gruposEnviados') || '[]');
    enviados.push(novoGrupo);
    localStorage.setItem('gruposEnviados', JSON.stringify(enviados));
  }

  // atualizar array local
  // remove versÃµes antigas com mesmo nome
  todosGrupos = todosGrupos.filter(g=>g.nome !== nome && g.nome !== modoEdicao);
  todosGrupos.push(novoGrupo);
  todosGrupos = ordenarEUnir(todosGrupos);

  renderizarGrupos(todosGrupos);

  modal.style.display = 'none';
  modoEdicao = null;

  // limpar campos
  inpNome.value=''; inpLink.value=''; inpFoto.value=''; inpCategoria.value=''; inpVipCode.value='';
});

/* ------- meus grupos view ------- */
meusBtn.addEventListener('click', ()=>{
  const usuario = localStorage.getItem('usuarioID');
  const meus = todosGrupos.filter(g => g.dono === usuario);
  if(meus.length === 0){
    alert('VocÃª ainda nÃ£o enviou nenhum grupo.');
    // manter listagem geral
    renderizarGrupos(todosGrupos);
  } else {
    renderizarGrupos(meus);
  }
});

/* ------- carregar grupos (grupos.json + localStorage + firebase) ------- */
async function carregarGrupos(){
  // carregar do grupos.json primeiro
  let jsonList = [];
  try{
    const res = await fetch('grupos.json');
    jsonList = await res.json();
  }catch(e){
    console.warn('NÃ£o foi possÃ­vel carregar grupos.json (ou arquivo vazio).', e);
    jsonList = [];
  }

  // grupos enviados localmente
  let enviadosLocal = JSON.parse(localStorage.getItem('gruposEnviados') || '[]');

  // pegar do firebase (escuta)
  const gruposRef = ref(db, 'grupos');
  onValue(gruposRef, snap => {
    const fbObj = snap.val() || {};
    // fbObj Ã© um map por chave; os valores sÃ£o os grupos
    const fbLista = Object.values(fbObj);

    // combinar: Firebase tem prioridade (para permitir ediÃ§Ã£o global); depois json; depois enviadosLocal
    // construir mapa por nome: fbLista -> jsonList -> enviadosLocal (mas enviadosLocal devem prevalecer se dono corresponde)
    const mapa = new Map();
    // adicionar jsonList
    jsonList.forEach(g => {
      // garantir formato mÃ­nimo
      mapa.set(g.nome, Object.assign({foto: g.foto || 'https://files.catbox.moe/ls07y5.jpg', vip: !!g.vip, timestamp: g.timestamp || 0}, g));
    });
    // adicionar firebase (sobrescreve)
    fbLista.forEach(g => {
      if(g && g.nome) mapa.set(g.nome, Object.assign({foto: g.foto || 'https://files.catbox.moe/ls07y5.jpg', vip: !!g.vip, timestamp: g.timestamp || 0}, g));
    });
    // adicionar enviados local (sobrescreve, Ãºtil para quem enviou e firebase demorar)
    enviadosLocal.forEach(g => {
      mapa.set(g.nome, Object.assign({foto: g.foto || 'https://files.catbox.moe/ls07y5.jpg', vip: !!g.vip, timestamp: g.timestamp || 0}, g));
    });

    const combinado = Array.from(mapa.values());
    todosGrupos = ordenarEUnir(combinado);
    renderizarGrupos(todosGrupos);
  });

  // tambÃ©m colocar inicialmente (caso onValue demore)
  const inicial = ordenarEUnir([...jsonList, ...enviadosLocal]);
  todosGrupos = inicial;
  renderizarGrupos(todosGrupos);
}

carregarGrupos();
</script>
</body>
</html>
